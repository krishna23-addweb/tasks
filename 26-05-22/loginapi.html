<html>
    <head>
        <script>
            function connect(){
                fetch("http://localhost:49158/web/session/token")
                .then(function(response){
                    return response;
                })
                .then(function(token){
                    console.log("CSRF token: "+ token);
                    userlogin(token);
    
                });
    
            }
            function userlogin(csrfToken){
                let uname= document.getElementById("username").value;
                let upass = document.getElementById("password").value;
                fetch("http://localhost:49158/web/user/login?_format=json", {
                    method: "POST",
                    headers: {
                        "Content-type": "application/json",
                        "X-CSRF-Token": csrfToken,
                    },
                    body: JSON.stringify({
                        name : uname,
                        pass : upass
                    }),
    
                })
                .then(response=> response.json())
                .then((data)=>{
                    if(data.message){
                        alert(data.message);
    
                    }
                    else{
                        console.log(data);
                        let main = document.querySelector("#main");
                        main.innerHTML = "Welcome " + data.current_user.name;
                    }
                });
    
                }      
        </script>
    </head>
<body>
    <form method="post">
        <input type="text" id="username"/>
        <input type="password" id="password"/>
        <input type="button" id="submit" value="Login" onclick="connect()"/>
    </form>
    <div id="main"></div>
</body>
</html>